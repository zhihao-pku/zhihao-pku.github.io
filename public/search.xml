<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>多元vs.单变量回归系数间的关系</title>
      <link href="/2021/07/22/%E5%A4%9A%E5%85%83vs-%E5%8D%95%E5%8F%98%E9%87%8F%E5%9B%9E%E5%BD%92%E7%B3%BB%E6%95%B0%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
      <url>/2021/07/22/%E5%A4%9A%E5%85%83vs-%E5%8D%95%E5%8F%98%E9%87%8F%E5%9B%9E%E5%BD%92%E7%B3%BB%E6%95%B0%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<p>多元回归系数和粗回归系数间的数量关系</p><span id="more"></span><h2><span id="r-packages-and-settings">R Packages and Settings</span></h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library(tidyverse)</span><br><span class="line">library(MASS)</span><br><span class="line">library(patchwork)</span><br><span class="line">library(mediation)</span><br><span class="line">rm(<span class="built_in">list</span> = ls())</span><br><span class="line"></span><br><span class="line">options(scipen = <span class="number">10</span>)</span><br><span class="line">theme_set(theme_classic())</span><br></pre></td></tr></table></figure><h2><span id="generating-samples">Generating Samples</span></h2><ul><li>三个变量：x1，x2，y；500行</li><li>x1、x2由二元正态分布生成</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">num &lt;- 500</span><br><span class="line">set.seed(<span class="number">123</span>)</span><br><span class="line">data &lt;- as.data.frame(mvrnorm(n = num, mu = <span class="built_in">c</span>(<span class="number">5</span>, <span class="number">5</span>), </span><br><span class="line">                              Sigma = matrix(<span class="built_in">c</span>(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>), nrow = <span class="number">2</span>, byrow = <span class="built_in">T</span>)))</span><br><span class="line"><span class="built_in">names</span>(data) &lt;- <span class="built_in">c</span>(<span class="string">&quot;x1&quot;</span>, <span class="string">&quot;x2&quot;</span>)</span><br><span class="line"></span><br><span class="line">p1 &lt;- ggplot(data = data, aes(x = x1, y = x2)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定x1、x2与y的关系</span></span><br><span class="line">data$y &lt;- 10 - <span class="number">2</span> * data$x1 + <span class="number">5</span> * data$x2 + rnorm(num, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">p2 &lt;- ggplot(data = data, aes(x = x1, y = y)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line">p3 &lt;- ggplot(data = data, aes(x = x2, y = y)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line">(p1 | plot_spacer()) /</span><br><span class="line">  (p2 | p3)</span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br></pre></td></tr></table></figure><figure><img src="https://zhihao-pku.oss-cn-beijing.aliyuncs.com/20201221121032.png" alt="plot of chunk unnamed-chunk-2"><figcaption aria-hidden="true">plot of chunk unnamed-chunk-2</figcaption></figure><h2><span id="粗回归系数间的关系">粗回归系数间的关系</span></h2><p><span class="math display">\[\widetilde \beta_1=\hat \beta_1+\widetilde\beta_{21}\times\hat\beta_2 \tag 1\]</span> - <span class="math inline">\(\widetilde \beta_1\)</span>：x1的粗回归系数 - <span class="math inline">\(\hat \beta_1\)</span>：调整x2后，x1的回归系数 - <span class="math inline">\(\hat \beta_2\)</span>：调整x1后，x2的回归系数 - <span class="math inline">\(\widetilde \beta_{12}\)</span>：x2对x1回归得到的系数</p><p>如果三个自变量x1、x2、x3，则公式1变为： <span class="math display">\[  \widetilde \beta_1=\hat \beta_1+\widetilde\beta_{21}\times\hat\beta_2 + \widetilde \beta_{31} \times \hat \beta_3 \tag 1  \]</span></p><p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">lm1 &lt;- lm(y ~ x1, data = data)</span><br><span class="line">(coef_rude1 &lt;- coef(lm1)[<span class="number">2</span>])</span><br><span class="line"><span class="comment">##       x1 </span></span><br><span class="line"><span class="comment">## 1.190021</span></span><br><span class="line"></span><br><span class="line">lm2 &lt;- lm(y ~ x2, data = data)</span><br><span class="line">(coef_rude2 &lt;- coef(lm2)[<span class="number">2</span>])</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 3.884736</span></span><br><span class="line"></span><br><span class="line">lm3 &lt;- lm(y ~ x1 + x2, data = data)</span><br><span class="line">(coef_adj1 &lt;- coef(lm3)[<span class="number">2</span>])</span><br><span class="line"><span class="comment">##        x1 </span></span><br><span class="line"><span class="comment">## -2.088688</span></span><br><span class="line">(coef_adj2 &lt;- coef(lm3)[<span class="number">3</span>])</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 5.287099</span></span><br><span class="line"></span><br><span class="line">lm4 &lt;- lm(x2 ~ x1, data = data)</span><br><span class="line">(coef21 &lt;- coef(lm4)[<span class="number">2</span>])</span><br><span class="line"><span class="comment">##        x1 </span></span><br><span class="line"><span class="comment">## 0.6201339</span></span><br><span class="line"></span><br><span class="line">lm5 &lt;- lm(x1 ~ x2, data = data)</span><br><span class="line">(coef12 &lt;- coef(lm5)[<span class="number">2</span>])</span><br><span class="line"><span class="comment">##        x2 </span></span><br><span class="line"><span class="comment">## 0.6714082</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证公式1</span></span><br><span class="line">(coef_rude1)</span><br><span class="line"><span class="comment">##       x1 </span></span><br><span class="line"><span class="comment">## 1.190021</span></span><br><span class="line">(coef_adj1 + coef21 * coef_adj2)</span><br><span class="line"><span class="comment">##       x1 </span></span><br><span class="line"><span class="comment">## 1.190021</span></span><br><span class="line"></span><br><span class="line">(coef_rude2)</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 3.884736</span></span><br><span class="line">(coef_adj2 + coef12 * coef_adj1)</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 3.884736</span></span><br></pre></td></tr></table></figure> ## 标准化回归系数间的关系 <span class="math display">\[\widetilde \beta_1=\hat \beta_1+R_{12}\times\hat\beta_2 \tag 2\]</span> - <span class="math inline">\(\widetilde \beta_1\)</span>：x1的标准化粗回归系数 - <span class="math inline">\(\hat \beta_1\)</span>：调整x2后，x1的标准化回归系数 - <span class="math inline">\(\hat \beta_2\)</span>：调整x1后，x2的标准化回归系数 - <span class="math inline">\(R_{12}\)</span>：x1与x2的Pearson相关系数</p><p>如果三个自变量x1、x2、x3，则公式2变为： <span class="math display">\[  \widetilde \beta_1=\hat \beta_1+R_{12}\times\hat\beta_2 + R_{13} \times \hat \beta_3 \tag 2  \]</span></p><p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 变量标准化</span></span><br><span class="line">data1 &lt;- data</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:ncol(data1)) &#123;</span><br><span class="line">  data1[, i] &lt;- scale(data1[, i], center = <span class="built_in">T</span>, scale = <span class="built_in">T</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lm1 &lt;- lm(y ~ x1, data = data1)</span><br><span class="line">coef_rude1_s &lt;- coef(lm1)[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">lm2 &lt;- lm(y ~ x2, data = data1)</span><br><span class="line">coef_rude2_s &lt;- coef(lm2)[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">lm3 &lt;- lm(y ~ x1 + x2, data = data1)</span><br><span class="line">coef_adj1_s &lt;- coef(lm3)[<span class="number">2</span>]</span><br><span class="line">coef_adj2_s &lt;- coef(lm3)[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关系数</span></span><br><span class="line">r12 &lt;- cor(data1$x1, data1$x2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证公式2</span></span><br><span class="line">coef_rude1_s</span><br><span class="line"><span class="comment">##        x1 </span></span><br><span class="line"><span class="comment">## 0.2395806</span></span><br><span class="line">coef_adj1_s + r12 * coef_adj2_s</span><br><span class="line"><span class="comment">##           [,1]</span></span><br><span class="line"><span class="comment">## [1,] 0.2395806</span></span><br><span class="line"></span><br><span class="line">coef_rude2_s</span><br><span class="line"><span class="comment">##        x2 </span></span><br><span class="line"><span class="comment">## 0.7516367</span></span><br><span class="line">coef_adj2_s + r12 * coef_adj1_s</span><br><span class="line"><span class="comment">##           [,1]</span></span><br><span class="line"><span class="comment">## [1,] 0.7516367</span></span><br></pre></td></tr></table></figure></p><h2><span id="非标准化回归系数是否也满足上述关系">非标准化回归系数是否也满足上述关系？</span></h2><p>结果：不满足</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r12 &lt;- cor(data$x1, data$x2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">coef_rude1</span><br><span class="line"><span class="comment">##       x1 </span></span><br><span class="line"><span class="comment">## 1.190021</span></span><br><span class="line">coef_adj1 + r12 * coef_adj2</span><br><span class="line"><span class="comment">##       x1 </span></span><br><span class="line"><span class="comment">## 1.322875</span></span><br><span class="line"></span><br><span class="line">coef_rude2</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 3.884736</span></span><br><span class="line">coef_adj2 + r12 * coef_adj1</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 3.939348</span></span><br></pre></td></tr></table></figure><h2><span id="基于残差粗回归系数间的关系">基于残差粗回归系数间的关系</span></h2><p><span class="math display">\[\hat y = \beta_0 + \beta_1^{&#39;} x_1 \tag {3.1}\]</span> <span class="math display">\[\hat y = \beta_0 + \beta_1 \times x_1 + \beta_2^{&#39;} \times x_2 \tag {3.2}\]</span></p><p><span class="math display">\[x_2 = \beta_0 + \beta_1 \times x_1 + \epsilon_1^{&#39;} \tag {3.3}\]</span></p><p><span class="math display">\[\hat y = \beta_0 + \beta_1^{&#39;} \times x_1 + \beta_2^{&#39;} \times \epsilon_1^{&#39;} \tag {3.4}\]</span> <span class="math inline">\(\beta_1^{&#39;}\)</span>, <span class="math inline">\(\beta_2^{&#39;}\)</span>, <span class="math inline">\(\epsilon_1^{&#39;}\)</span>在4个公式中是相等的，其他符号在4个公式中的值可能不一样</p><p>如果三个自变量x1、x2、x3，则公式3变为： <span class="math display">\[\hat y = \beta_0 + \beta_1^{&#39;} x_1 \tag {3.1}\]</span> <span class="math display">\[\hat y = \beta_0 + \beta_1 x_1 + \beta_2^{&#39;} x_2 \tag {3.2}\]</span> <span class="math display">\[\hat y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3^{&#39;} x_3 \tag {3.3}\]</span> <span class="math display">\[x_2 = \beta_0 + \beta_1 x_1 + \epsilon_1^{&#39;} \tag {3.4}\]</span> <span class="math display">\[x_3 = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \epsilon_2^{&#39;} \tag {3.5}\]</span> <span class="math display">\[\hat y = \beta_0 + \beta_1^{&#39;} x_1 + \beta_2^{&#39;} \epsilon_1^{&#39;} + \beta_3^{&#39;} \epsilon_2^{&#39;} \tag {3.6}\]</span> <span class="math inline">\(\beta_1^{&#39;}\)</span>，<span class="math inline">\(\beta_2^{&#39;}\)</span>，<span class="math inline">\(\beta_3^{&#39;}\)</span>，<span class="math inline">\(\epsilon_2^{&#39;}\)</span>，<span class="math inline">\(\epsilon_2^{&#39;}\)</span>在6个公式中是相等的，其他符号在6个公式中的值可能不一样</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># beta1</span></span><br><span class="line">lm1 &lt;- lm(y ~ x1, data = data)</span><br><span class="line">coef(lm1)</span><br><span class="line"><span class="comment">## (Intercept)          x1 </span></span><br><span class="line"><span class="comment">##   19.266370    1.190021</span></span><br><span class="line"></span><br><span class="line">lm2 &lt;- lm(y ~ x2, data = data)</span><br><span class="line">coef(lm2)</span><br><span class="line"><span class="comment">## (Intercept)          x2 </span></span><br><span class="line"><span class="comment">##    5.653791    3.884736</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># beta2</span></span><br><span class="line">lm3 &lt;- lm(y ~ x1 + x2, data = data)</span><br><span class="line">coef(lm3)</span><br><span class="line"><span class="comment">## (Intercept)          x1          x2 </span></span><br><span class="line"><span class="comment">##    9.128720   -2.088688    5.287099</span></span><br><span class="line"></span><br><span class="line">lm4 &lt;- lm(x2 ~ x1, data = data)</span><br><span class="line">data$res &lt;- residuals(lm4)</span><br><span class="line"></span><br><span class="line"><span class="comment"># beta1和beta2</span></span><br><span class="line">lm5 &lt;- lm(y ~ x1 + res, data = data)</span><br><span class="line">coef(lm5)</span><br><span class="line"><span class="comment">## (Intercept)          x1         res </span></span><br><span class="line"><span class="comment">##   19.266370    1.190021    5.287099</span></span><br></pre></td></tr></table></figure><h2><span id="标准化回归系数与粗回归系数">标准化回归系数与粗回归系数</span></h2><p><span class="math display">\[标准化回归系数 = 粗回归系数 \times \frac{该自变量的标准差}{因变量的标准差} \tag 4\]</span></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准差</span></span><br><span class="line">sd1 &lt;- sd(data$x1)</span><br><span class="line">sd2 &lt;- sd(data$x2)</span><br><span class="line">sdy &lt;- sd(data$y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证公式4</span></span><br><span class="line">coef_adj1_s</span><br><span class="line"><span class="comment">##         x1 </span></span><br><span class="line"><span class="comment">## -0.4205045</span></span><br><span class="line">coef_adj1 * sd1 / sdy</span><br><span class="line"><span class="comment">##         x1 </span></span><br><span class="line"><span class="comment">## -0.4205045</span></span><br><span class="line"></span><br><span class="line">coef_adj2_s</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 1.022972</span></span><br><span class="line">coef_adj2 * sd2 / sdy</span><br><span class="line"><span class="comment">##       x2 </span></span><br><span class="line"><span class="comment">## 1.022972</span></span><br></pre></td></tr></table></figure><h2><span id="结合实际意义">结合实际意义</span></h2><ul><li><p>x1：出生体重，bw（birth weight）</p></li><li><p>x2：成人体重，aw（adult weight）</p></li><li><p>y：成人血压，bp（blood pressure）</p><p>注意bw的粗回归系数为正，多元回归系数为负。因为bw与aw的粗回归系数和aw和bp的多元回归系数同号：</p></li><li><p>bw与aw的粗回归系数为正</p></li><li><p>aw和bp的多元回归系数为正</p></li><li><p>这说明，在成人体重一定的情况下，出生体重越大血压越低（bw的直接效应）</p></li><li><p>类似于病例对照研究，逆序因果；选定一批成人体重一致的人群，观察他们出生体重与成人血压的关系</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">names</span>(data) &lt;- <span class="built_in">c</span>(<span class="string">&quot;bw&quot;</span>, <span class="string">&quot;aw&quot;</span>, <span class="string">&quot;bp&quot;</span>)</span><br><span class="line"></span><br><span class="line">p4 &lt;- ggplot(data = data, aes(x = bw, y = aw)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line">p5 &lt;- ggplot(data = data, aes(x = bw, y = bp)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line">p6 &lt;- ggplot(data = data, aes(x = aw, y = bp)) + </span><br><span class="line">  geom_point() + </span><br><span class="line">  geom_smooth(method = <span class="string">&quot;lm&quot;</span>)</span><br><span class="line"></span><br><span class="line">(p4 | plot_spacer()) /</span><br><span class="line">  (p5 | p6)</span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br><span class="line"><span class="comment">## `geom_smooth()` using formula &#x27;y ~ x&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><figure><img src="https://zhihao-pku.oss-cn-beijing.aliyuncs.com/20201221121037.png" alt="plot of chunk unnamed-chunk-8"><figcaption aria-hidden="true">plot of chunk unnamed-chunk-8</figcaption></figure><h2><span id="中介分析">中介分析</span></h2><p>出生体重是不是通过成人体重对成人血压起作用 - ACME：average causal mediation effect：中介效应 - ADE：average direct effect：直接效应 - Total Effect = ACME+ADE - Prop.Mediated = ACME / Total Effect</p><p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">m1 &lt;- lm(aw ~ bw, data = data)</span><br><span class="line">m2 &lt;- lm(bp ~ aw + bw, data = data)</span><br><span class="line"></span><br><span class="line">med &lt;- mediate(model.m = m1, model.y = m2, treat = <span class="string">&quot;bw&quot;</span>, mediator = <span class="string">&quot;aw&quot;</span>, sims = <span class="number">100</span>)</span><br><span class="line">summary(med)</span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Causal Mediation Analysis </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Quasi-Bayesian Confidence Intervals</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">##                Estimate 95% CI Lower 95% CI Upper p-value    </span></span><br><span class="line"><span class="comment">## ACME              3.278        2.940         3.67  &lt;2e-16 ***</span></span><br><span class="line"><span class="comment">## ADE              -2.060       -2.442        -1.76  &lt;2e-16 ***</span></span><br><span class="line"><span class="comment">## Total Effect      1.218        0.865         1.60  &lt;2e-16 ***</span></span><br><span class="line"><span class="comment">## Prop. Mediated    2.675        2.148         3.54  &lt;2e-16 ***</span></span><br><span class="line"><span class="comment">## ---</span></span><br><span class="line"><span class="comment">## Signif. codes:  0 &#x27;***&#x27; 0.001 &#x27;**&#x27; 0.01 &#x27;*&#x27; 0.05 &#x27;.&#x27; 0.1 &#x27; &#x27; 1</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Sample Size Used: 500 </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Simulations: 100</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.278</span> + (-<span class="number">2.060</span>)</span><br><span class="line"><span class="comment">## [1] 1.218</span></span><br><span class="line"><span class="number">3.278</span> / <span class="number">1.218</span></span><br><span class="line"><span class="comment">## [1] 2.691297</span></span><br></pre></td></tr></table></figure></p><h3><span id="中介分析系数与前述回归系数的关系">中介分析系数与前述回归系数的关系</span></h3><ul><li>coef_rude1 = Total Effect（bw的总效应）</li><li>coef_adj1 = ADE（average direct effect，bw的直接效应）</li><li>中介效应与直接效应是负向关系，且中介效应强于直接效应</li></ul><h3><span id="是否调整aw或bw">是否调整aw或bw？</span></h3><ul><li>分析bw与bp关系时，aw不是混杂，是中介变量，如果看bw的总效应，则不应该调整</li><li>分析aw与bp关系时，bw是混杂，应该调整（bw既跟aw有关（coef_rude），bw又跟bp有关（coef_adj1））</li></ul><h2><span id="小结">小结</span></h2><ul><li><span class="math inline">\(\widetilde \beta_{21}\)</span>与<span class="math inline">\(\hat \beta_2\)</span>的正负号相同，则粗回归系数<span class="math inline">\(\widetilde \beta_1\)</span>变大；若<span class="math inline">\(\widetilde \beta_{21}\)</span>的与<span class="math inline">\(\hat \beta_2\)</span>的正负号相反，则粗回归系数<span class="math inline">\(\widetilde \beta_1\)</span>变小</li><li><span class="math inline">\(\widetilde \beta_{21}\)</span>是粗回归系数，正负号相对容易判断；<span class="math inline">\(\hat \beta_2\)</span>是多元回归系数，正符号不容易判断</li></ul><h2><span id="案例">案例</span></h2><p><strong>BMI和腰围与全因死亡率的关系</strong> - BMI和腰围对全因死亡率的粗回归系数均为正 - 但BMI和腰围对全因死亡率的多元回归系数，BMI为负，腰围为正 - 给定腰围，BMI越大表明上半身肌肉越发达，锻炼越多 - 给定BMI，腰围越大越表明是中心型肥胖</p>]]></content>
      
      
      <categories>
          
          <category> 统计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 回归 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多重填补回归系数的合并</title>
      <link href="/2021/07/22/%E5%A4%9A%E9%87%8D%E5%A1%AB%E8%A1%A5%E5%9B%9E%E5%BD%92%E7%B3%BB%E6%95%B0%E7%9A%84%E5%90%88%E5%B9%B6/"/>
      <url>/2021/07/22/%E5%A4%9A%E9%87%8D%E5%A1%AB%E8%A1%A5%E5%9B%9E%E5%BD%92%E7%B3%BB%E6%95%B0%E7%9A%84%E5%90%88%E5%B9%B6/</url>
      
        <content type="html"><![CDATA[<p>多重填补是Rubin在1978年提出的一种缺失数据填补方法。基本思路是：</p><ol type="1"><li>对于待分析的含缺失的数据独立填补M次生成M份完整数据</li><li>对这M份完整数据分别分析得出M个估计量</li><li>基于一定方法将这M个估计量合并生成最终的一个估计量</li></ol><span id="more"></span><p>该方法得出的估计量相比使用单一值填补更为稳健（估计量为多次填补数据估计量的均值）；计算估计量标准误时可以把多次填补间的变异加以考虑（一般会导致更大的标准误）。这里介绍一下步骤3：如何由填补产生的M套回归模型的回归系数合并成最终的一套回归系数</p><h2><span id="方法一使用mice包标准流程">方法一：使用mice包标准流程</span></h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(tidyverse)</span><br><span class="line">library(mice)</span><br><span class="line">rm(<span class="built_in">list</span> = ls())</span><br></pre></td></tr></table></figure><p>示例数据为mice包的employee数据集</p><ul><li>IQ: candidate IQ score</li><li>wbeing: candidate well-being score</li><li>jobperf: candidate job performance score</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">data &lt;- employee</span><br><span class="line">head(data)</span><br><span class="line"><span class="comment">##   IQ wbeing jobperf</span></span><br><span class="line"><span class="comment">## 1 78     13      NA</span></span><br><span class="line"><span class="comment">## 2 84      9      NA</span></span><br><span class="line"><span class="comment">## 3 84     10      NA</span></span><br><span class="line"><span class="comment">## 4 85     10      NA</span></span><br><span class="line"><span class="comment">## 5 87     NA      NA</span></span><br><span class="line"><span class="comment">## 6 91      3      NA</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 三个变量缺失情况</span></span><br><span class="line">apply(data, <span class="number">2</span>, <span class="keyword">function</span>(x) <span class="built_in">sum</span>(<span class="built_in">is.na</span>(x)))</span><br><span class="line"><span class="comment">##      IQ  wbeing jobperf </span></span><br><span class="line"><span class="comment">##       0       3      10</span></span><br></pre></td></tr></table></figure><p>填补3次，并计算合并后的估计值</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">M &lt;- 3 <span class="comment"># 多重填补次数</span></span><br><span class="line">set.seed(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成3份填补后数据</span></span><br><span class="line">m &lt;- mice(data = data, m = M)</span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">##  iter imp variable</span></span><br><span class="line"><span class="comment">##   1   1  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   1   2  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   1   3  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   2   1  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   2   2  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   2   3  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   3   1  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   3   2  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   3   3  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   4   1  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   4   2  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   4   3  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   5   1  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   5   2  wbeing  jobperf</span></span><br><span class="line"><span class="comment">##   5   3  wbeing  jobperf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算3份填补数据的估计值</span></span><br><span class="line">fit &lt;- with(m, expr = lm(IQ ~ wbeing + jobperf))</span><br><span class="line"><span class="built_in">class</span>(fit) <span class="comment"># &quot;mira&quot;对象</span></span><br><span class="line"><span class="comment">## [1] &quot;mira&quot;   &quot;matrix&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 汇总3份填补数据的估计值</span></span><br><span class="line">summary(pool(fit), conf.int = <span class="built_in">T</span>, conf.level = <span class="number">0.95</span>)</span><br><span class="line"><span class="comment">##          term   estimate std.error statistic       df    p.value      2.5 %</span></span><br><span class="line"><span class="comment">## 1 (Intercept) 77.3473539 26.889694 2.8764684 3.557769 0.05195377  -1.116587</span></span><br><span class="line"><span class="comment">## 2      wbeing  0.8973998  1.104307 0.8126358 9.026164 0.43733475  -1.599614</span></span><br><span class="line"><span class="comment">## 3     jobperf  1.1997289  2.652258 0.4523425 1.870813 0.69802345 -11.001455</span></span><br><span class="line"><span class="comment">##       97.5 %</span></span><br><span class="line"><span class="comment">## 1 155.811295</span></span><br><span class="line"><span class="comment">## 2   3.394413</span></span><br><span class="line"><span class="comment">## 3  13.400912</span></span><br></pre></td></tr></table></figure><h2><span id="方法二对每一份填补数据自己构建模型">方法二：对每一份填补数据自己构建模型</span></h2><p>有时候对原始数据填补后，需要新生成一些变量才能构建模型，这时候方法一的标准流程可能不适用；比如填补完数据中缺失的身高和体重后，要新生成BMI参与后续建模。此时可以获取每一份填补后的数据，分别对其处理并建模，然后使用pool()函数将多个模型估计值合并生成最终估计值</p><p>pool()函数说明中：第一个参数object可以是"mira"对象，也可以是一个列表；若为列表，则列表中每一个对象（回归模型）都应适用于coef()函数返回回归系数和vcov()函数返回回归系数协方差矩阵（mice3.0版本后会有其他要求） <img src="https://zhihao-pku.oss-cn-beijing.aliyuncs.com/20210520153056.png"></p><p><img src="https://zhihao-pku.oss-cn-beijing.aliyuncs.com/20210520153015.png"> 可见结果与方法一相同</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得每一份填补后的数据</span></span><br><span class="line">data1 &lt;- complete(m, <span class="number">1</span>)</span><br><span class="line">data2 &lt;- complete(m, <span class="number">2</span>)</span><br><span class="line">data3 &lt;- complete(m, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对每一份填补后的数据建模</span></span><br><span class="line">fit1 &lt;- lm(IQ ~ wbeing + jobperf, data = data1)</span><br><span class="line">fit2 &lt;- lm(IQ ~ wbeing + jobperf, data = data2)</span><br><span class="line">fit3 &lt;- lm(IQ ~ wbeing + jobperf, data = data3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并3个模型</span></span><br><span class="line">summary(pool(<span class="built_in">list</span>(fit1, fit2, fit3)), conf.int = <span class="built_in">T</span>, conf.level = <span class="number">0.95</span>)</span><br><span class="line"><span class="comment">##          term   estimate std.error statistic       df    p.value      2.5 %</span></span><br><span class="line"><span class="comment">## 1 (Intercept) 77.3473539 26.889694 2.8764684 3.557769 0.05195377  -1.116587</span></span><br><span class="line"><span class="comment">## 2      wbeing  0.8973998  1.104307 0.8126358 9.026164 0.43733475  -1.599614</span></span><br><span class="line"><span class="comment">## 3     jobperf  1.1997289  2.652258 0.4523425 1.870813 0.69802345 -11.001455</span></span><br><span class="line"><span class="comment">##       97.5 %</span></span><br><span class="line"><span class="comment">## 1 155.811295</span></span><br><span class="line"><span class="comment">## 2   3.394413</span></span><br><span class="line"><span class="comment">## 3  13.400912</span></span><br></pre></td></tr></table></figure><h2><span id="方法三手工计算合并后回归系数及其95-ci">方法三：手工计算合并后回归系数及其95% CI</span></h2><p>合并思路：</p><ul><li>最终回归系数估计值为M个填补数据估计值的均值</li><li>最终回归系数标准误计算需考虑填补内变异（回归系数估计值在M次填补中变异的平均）和填补间变异（回归系数估计值在M次填补间的变异）两部分</li></ul><h3><span id="计算步骤">计算步骤</span></h3><ul><li>步骤1-4参考【Rubin, D.B. (1987). Multiple Imputation for Nonresponse in Surveys. New York: John Wiley and Sons.】P76～</li><li>步骤5参考【Barnard, J. and Rubin, D.B. (1999). Small sample degrees of freedom with multiple imputation. Biometrika, 86, 948-955.】</li></ul><p>1、计算M次填补回归系数估计值的均值；<span class="math inline">\(\hat Q_i\)</span>为第<span class="math inline">\(i\)</span>次填补回归系数估计值</p><p><span class="math display">\[\overline Q_m = \sum_{i = 1}^{m}\hat Q_i / m\]</span> 2、计算M次填补回归系数协方差矩阵均值（矩阵对应元素平均），即填补内变异；<span class="math inline">\(U_i\)</span>为第<span class="math inline">\(i\)</span>次填补回归系数协方差矩阵,可以直接通过<code>vcov(fit)</code>获得，也可以通过<span class="math inline">\((X^T V^{-1} X)^{-1}\)</span>手工计算（<span class="math inline">\(X\)</span>为模型设计矩阵，<span class="math inline">\(V\)</span>为模型残差协方差矩阵） <span class="math display">\[\overline U_m = \sum_{i = 1}^{n}U_i / m\]</span></p><p>3、计算每次填补<span class="math inline">\(\hat Q_i\)</span>相比于<span class="math inline">\(\overline Q_m\)</span>的变异，即填补间变异 <span class="math display">\[B_m = \sum_{i = 1}^{m}(\hat Q_i - \overline Q_m) \times (\hat Q_i - \overline Q_m)^T / (m - 1)\]</span></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Q_set &lt;- <span class="literal">NULL</span></span><br><span class="line">U_set &lt;- <span class="built_in">list</span>()</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:M) &#123;</span><br><span class="line">  data_i &lt;- complete(m, i)</span><br><span class="line">  fit_i &lt;- lm(IQ ~ wbeing + jobperf, data = data_i)</span><br><span class="line">  V_i &lt;- sigma(fit_i)^<span class="number">2</span> * diag(nrow(data))</span><br><span class="line">  X_i &lt;- model.matrix(~ wbeing + jobperf, data = data_i)</span><br><span class="line">  U_i &lt;- solve(t(X_i) %*% solve(V_i) %*% X_i)</span><br><span class="line">  Q_set &lt;- bind_rows(Q_set, coefficients(fit_i))</span><br><span class="line">  U_set[[i]] &lt;- U_i</span><br><span class="line">&#125;</span><br><span class="line">Qm &lt;- matrix(apply(Q_set, <span class="number">2</span>, mean), ncol = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">SUM_Um &lt;- 0</span><br><span class="line">SUM_Bm &lt;- 0</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:M) &#123;</span><br><span class="line">  SUM_Um &lt;- SUM_Um + U_set[[i]]</span><br><span class="line">  SUM_Bm &lt;- SUM_Bm + (matrix(unlist(Q_set[i, ]), ncol = <span class="number">1</span>) - Qm) %*%</span><br><span class="line">    t(matrix(unlist(Q_set[i, ]), ncol = <span class="number">1</span>) - Qm)</span><br><span class="line">&#125;</span><br><span class="line">Um &lt;- SUM_Um / M</span><br><span class="line">Bm &lt;- SUM_Bm / (M - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>4、总变异<span class="math inline">\(T_m\)</span>由填补内变异和填补间变异两部分组成 <span class="math display">\[T_m = \overline U_m + (1 + 1/m)\times B_m\]</span> 以上步骤便计算出了合并后回归系数估计值<span class="math inline">\(\overline Q_m\)</span>及其标准误<span class="math inline">\(\sqrt{diag(T_m)}\)</span></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Tm &lt;- Um + (<span class="number">1</span> + <span class="number">1</span> / M) * Bm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 估计值</span></span><br><span class="line">Qm</span><br><span class="line"><span class="comment">##            [,1]</span></span><br><span class="line"><span class="comment">## [1,] 77.3473539</span></span><br><span class="line"><span class="comment">## [2,]  0.8973998</span></span><br><span class="line"><span class="comment">## [3,]  1.1997289</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准误</span></span><br><span class="line">(se &lt;- <span class="built_in">sqrt</span>(diag(Tm)))</span><br><span class="line"><span class="comment">## (Intercept)      wbeing     jobperf </span></span><br><span class="line"><span class="comment">##   26.889694    1.104307    2.652258</span></span><br></pre></td></tr></table></figure><p>5、计算回归系数自由度<br>这里不同于一般线性回归，有一个整体自由度，每个回归系数95% CI基于该相同自由度计算。由于每个变量缺失量不同，因而各回归系数有不同的自由度</p><p>5.1、原始自由度 <span class="math display">\[v_m = (m - 1) / r_m^2\]</span> 其中<span class="math inline">\(r_m = (1 + 1/m) * diag(B_m / T_m)\)</span>；<span class="math inline">\(B_m / T_m\)</span>指矩阵对应元素相除</p><p>5.2、校正后自由度 <span class="math display">\[\tilde v_m = v_{com} / (1/(\lambda(v_{com}) \times (1 - \hat r_m)) + v_{com}/v_m)\]</span> 其中<span class="math inline">\(\lambda(x) = (x + 1) / (x + 3)\)</span>；mice包回归系数95% CI及p值是基于校正后自由度计算的，目的是校正<strong>理论完整数据</strong>样本量的影响</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原始自由度vm</span></span><br><span class="line">rm &lt;- (<span class="number">1</span> + <span class="number">1</span> / M) * diag((Bm / Tm))</span><br><span class="line">vm &lt;- (M - <span class="number">1</span>) * rm^(-<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># vcom是理论完整数据自由度</span></span><br><span class="line"><span class="comment"># 即假设原始数据无缺失（size=20）的情况下，模型有3个回归系数（含截距）</span></span><br><span class="line"><span class="comment"># 对应自由度为20-3=17</span></span><br><span class="line">vcom &lt;- 17</span><br><span class="line">lamba &lt;- <span class="keyword">function</span>(x) &#123;</span><br><span class="line">  <span class="built_in">return</span>((x + <span class="number">1</span>) / (x + <span class="number">3</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 校正后自由度df</span></span><br><span class="line">df &lt;- vcom  / (<span class="number">1</span> / (lamba(vcom) * (<span class="number">1</span> - rm)) + vcom / vm)</span><br></pre></td></tr></table></figure><p>6、有了t分布自由度，便可计算合并后回归系数估计值假设检验的p值及其95%CI</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># t统计量</span></span><br><span class="line">t &lt;- Qm / se</span><br><span class="line"></span><br><span class="line"><span class="comment"># p值</span></span><br><span class="line">p.value &lt;- (<span class="number">1</span> - pt(q = <span class="built_in">abs</span>(t), df = df)) * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 95% CI</span></span><br><span class="line">lwr &lt;- Qm - qt(p = <span class="number">0.975</span>, df = df) * se</span><br><span class="line">upr &lt;- Qm + qt(p = <span class="number">0.975</span>, df = df) * se</span><br></pre></td></tr></table></figure><p>将上述手工计算结果整理如下；对比上述mice包pool()函数输出结果，与手工计算结果一致</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data.frame(estimate = Qm, </span><br><span class="line">           std.error = se, </span><br><span class="line">           df = df, </span><br><span class="line">           t = t, </span><br><span class="line">           p.value = p.value, </span><br><span class="line">           lwr = lwr, </span><br><span class="line">           upr = upr)</span><br><span class="line"><span class="comment">##               estimate std.error       df         t    p.value        lwr        upr</span></span><br><span class="line"><span class="comment">## (Intercept) 77.3473539 26.889694 3.557769 2.8764684 0.05195377  -1.116587 155.811295</span></span><br><span class="line"><span class="comment">## wbeing       0.8973998  1.104307 9.026164 0.8126358 0.43733475  -1.599614   3.394413</span></span><br><span class="line"><span class="comment">## jobperf      1.1997289  2.652258 1.870813 0.4523425 0.69802345 -11.001455  13.400912</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 统计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 回归 </tag>
            
            <tag> 缺失值 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
